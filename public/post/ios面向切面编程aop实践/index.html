<!DOCTYPE html>
<html lang="zh-CN">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta property="og:site_name" content="XTCEL Blog">
    <meta property="og:type" content="article">

    
    <meta property="og:image" content="http://localhost:1313//https://s2.loli.net/2024/06/20/JXsELighNau2MkR.jpg">
    <meta property="twitter:image" content="http://localhost:1313//https://s2.loli.net/2024/06/20/JXsELighNau2MkR.jpg" />
    

    
    <meta name="title" content="iOSé¢å‘åˆ‡é¢ç¼–ç¨‹AOPå®è·µ" />
    <meta property="og:title" content="iOSé¢å‘åˆ‡é¢ç¼–ç¨‹AOPå®è·µ" />
    <meta property="twitter:title" content="iOSé¢å‘åˆ‡é¢ç¼–ç¨‹AOPå®è·µ" />
    

    
    <meta name="description" content="iOSé¢å‘åˆ‡é¢ç¼–ç¨‹AOPå®è·µ">
    <meta property="og:description" content="iOSé¢å‘åˆ‡é¢ç¼–ç¨‹AOPå®è·µ" />
    <meta property="twitter:description" content="iOSé¢å‘åˆ‡é¢ç¼–ç¨‹AOPå®è·µ" />
    

    
    <meta property="twitter:card" content="summary" />
    
    

    <meta name="keyword"  content="å¼ å‹‡, Xtcel, xtcel, å¼ å‹‡çš„ç½‘ç»œæ—¥å¿—, XTCEL Blog, åšå®¢, ä¸ªäººç½‘ç«™, äº’è”ç½‘, Web, ç§»åŠ¨ç«¯å¼€å‘, iOS, Android, Flutter, Electron, Tauri, åµŒå…¥å¼,">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>iOSé¢å‘åˆ‡é¢ç¼–ç¨‹AOPå®è·µ | å¼ å‹‡çš„åšå®¢ | XTCEL Blog</title>

    <link rel="canonical" href="/post/ios%E9%9D%A2%E5%90%91%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8Baop%E5%AE%9E%E8%B7%B5/">

    
    
    
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hugo-theme-cleanwhite.min.css">

    
    <link rel="stylesheet" href="/css/zanshang.css">

    
    <link rel="stylesheet" href="/css/font-awesome.all.min.css">

    
    

    
    <script src="/js/jquery.min.js"></script>

    
    <script src="/js/bootstrap.min.js"></script>

    
    <script src="/js/hux-blog.min.js"></script>

    
    <script src="/js/lazysizes.min.js"></script>

    
    

</head>






<nav class="navbar navbar-default navbar-custom navbar-fixed-top">

    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">XTCEL Blog</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">All Posts</a>
                    </li>
                    
                        
                        <li>
                            <a href="/categories/ios/">ios</a>
                        </li>
                        
                        <li>
                            <a href="/categories/tech/">tech</a>
                        </li>
                        
                    
                    
		    
                        <li><a href="/top/books/">BOOKS</a></li>
                    
                        <li><a href="/top/archive/">ARCHIVE</a></li>
                    
                        <li><a href="/top/about/">ABOUT</a></li>
                    
		            <li>
                        <a href="/search"><i class="fa fa-search"></i></a>
		           </li>
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header {
        background-image: url('https://s2.loli.net/2024/06/20/JXsELighNau2MkR.jpg')
    }
</style>

<header class="intro-header" >

    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/ios" title="iOS">
                            iOS
                        </a>
                        
                        <a class="tag" href="/tags/aop" title="AOP">
                            AOP
                        </a>
                        
                        <a class="tag" href="/tags/runtime" title="Runtime">
                            Runtime
                        </a>
                        
                    </div>
                    <h1>iOSé¢å‘åˆ‡é¢ç¼–ç¨‹AOPå®è·µ</h1>
                    <h2 class="subheading">iOSé¢å‘åˆ‡é¢ç¼–ç¨‹AOPå®è·µ</h2>
                    <span class="meta">
                        
                            Posted by 
                            
                                xtcel
                             
                            on 
                            Wednesday, July 13, 2016
                            
                            
                            
                            
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                
                <h4 id="ä»€ä¹ˆæ˜¯aop">ä»€ä¹ˆæ˜¯AOP</h4>
<p>AOPï¼šAspect Oriented Programmingï¼Œè¯‘ä¸ºé¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚</p>
<p>åœ¨ä¸ä¿®æ”¹æºä»£ç çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡è¿è¡Œæ—¶ç»™ç¨‹åºæ·»åŠ ç»Ÿä¸€åŠŸèƒ½çš„æŠ€æœ¯ã€‚</p>
<p>æˆ‘è§‰å¾—å…¶ä¸­æœ‰ä¸¤å±‚æ¶µä¹‰ï¼š</p>
<ul>
<li>ç¬¬ä¸€ï¼šä¸ä¿®æ”¹æºä»£ç ï¼Œå³å°½å¯èƒ½çš„è§£è€¦ã€‚</li>
<li>ç¬¬äºŒï¼šæ·»åŠ ç»Ÿä¸€çš„åŠŸèƒ½ï¼Œå³æˆ‘ä»¬èƒ½å®ç°çš„æ˜¯æ·»åŠ ç»Ÿä¸€çš„å•ä¸€çš„åŠŸèƒ½ï¼Œåœ¨æŸå¤„ä½¿ç”¨AOPï¼Œæˆ‘ä»¬åªèƒ½å®ç°ä¸€é¡¹å•ä¸€çš„åŠŸèƒ½ã€‚å¦‚ï¼šæ—¥å¿—è®°å½•ã€‚å½“ç„¶ä½ å¯ä»¥æ·»åŠ å¤šä¸ªAOPçš„æ¨¡å—åˆ°é¡¹ç›®ä¸­ï¼Œæ¯ä¸€ä¸ªå®ç°ä¸åŒåŠŸèƒ½ï¼Œä½†æ˜¯æ¯ä¸€ä¸ªåŠŸèƒ½å¿…é¡»æ˜¯å•ä¸€çš„ã€‚</li>
</ul>
<p>ä¸»è¦åŠŸèƒ½ï¼šæ—¥å¿—è®°å½•ï¼Œæ€§èƒ½ç»Ÿè®¡ç­‰ã€‚</p>
<h4 id="iosä¸­å¦‚ä½•å®ç°aop">iOSä¸­å¦‚ä½•å®ç°AOP</h4>
<p>æœ‰å¿ƒçš„è¯»è€…å¯èƒ½ä¼šå‘ç°ï¼Œæˆ‘åœ¨ä¸Šé¢çš„AOPç®€ä»‹ä¸­å¹¶æ²¡æœ‰åŸè¯æ¬ç”¨ç™¾åº¦ç™¾ç§‘çš„AOPç®€ä»‹ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ç¯‡iOSçš„AOPæ•™ç¨‹ï¼Œåœ¨OCä¸­æˆ‘ä»¬å°±æ˜¯ç”¨è¿è¡Œæ—¶æ¥ç»™å®ç°AOPçš„ã€‚ï¼ˆæˆ‘ä»¬åŸºæœ¬ä¸ä¼šä½¿ç”¨é¢„ç¼–è¯‘æ–¹å¼æ¥å®ç°AOPï¼‰</p>
<p>åœ¨iOSä¸­å®ç°AOPçš„æ ¸å¿ƒæŠ€æœ¯æ˜¯Runtime,ä½¿ç”¨Runtimeçš„Method Swizzlingé»‘é­”æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ç§»èŠ±æ¥æœ¨ï¼Œåœ¨è¿è¡Œæ—¶å°†æ–¹æ³•çš„å…·ä½“å®ç°æ·»æ²¹åŠ é†‹ã€å·æ¢æ¢æŸ±ã€‚</p>
<p>ç‚¹æ­¤ç§»æ­¥äº†è§£<a href="http://www.cocoachina.com/ios/20160121/15076.html">Method Swizzling</a></p>
<h4 id="aopæŠ€æœ¯å®ç°">AOPæŠ€æœ¯å®ç°</h4>
<p>è¶Šæ˜¯åº•å±‚çš„æ¡†æ¶è¶Šæ˜¯éš¾ç”¨ï¼Œä»»ä½•è¯­è¨€çš†æ˜¯å¦‚æ­¤ï¼ŒåŒæ ·Method Swizzlingä¹Ÿä¸ä¾‹å¤–ã€‚é‚£æ˜¯å¦æœ‰ä¸€ä¸ªç¬¬ä¸‰åº“ï¼Œå¯ä»¥è®©æˆ‘ä»¬è½»æ¾é©¾é©­Method Swizzlingé»‘é­”æ³•å‘¢ï¼Ÿ</p>
<p>å½“ç„¶æœ‰ï¼Œè€Œä¸”ä¸æ­¢ä¸€ä¸ªï¼Œå…¶ä¸­æœ€è‘—åçš„è¦æ•°<a href="https://github.com/steipete/Aspects">Aspects</a>ï¼ŒAspectsçš„ä½¿ç”¨éå¸¸ç®€å•ï¼Œæ•´ä¸ªåº“å°è£…ä¸ºä¸¤ä¸ªæ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Objective-C" data-lang="Objective-C"><span style="display:flex;"><span>+ (<span style="color:#8be9fd">id</span><span style="color:#ff79c6">&lt;</span>AspectToken<span style="color:#ff79c6">&gt;</span>)<span style="color:#50fa7b">aspect_hookSelector:</span>(<span style="color:#8be9fd">SEL</span>)<span style="color:#8be9fd;font-style:italic">selector</span>
</span></span><span style="display:flex;"><span>                      <span style="color:#50fa7b">withOptions:</span>(AspectOptions)<span style="color:#8be9fd;font-style:italic">options</span>
</span></span><span style="display:flex;"><span>                       <span style="color:#50fa7b">usingBlock:</span>(<span style="color:#8be9fd">id</span>)<span style="color:#8be9fd;font-style:italic">block</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#50fa7b">error:</span>(NSError <span style="color:#ff79c6">**</span>)<span style="color:#8be9fd;font-style:italic">error</span>;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Objective-C" data-lang="Objective-C"><span style="display:flex;"><span>- (<span style="color:#8be9fd">id</span><span style="color:#ff79c6">&lt;</span>AspectToken<span style="color:#ff79c6">&gt;</span>)<span style="color:#50fa7b">aspect_hookSelector:</span>(<span style="color:#8be9fd">SEL</span>)<span style="color:#8be9fd;font-style:italic">selector</span>
</span></span><span style="display:flex;"><span>                      <span style="color:#50fa7b">withOptions:</span>(AspectOptions)<span style="color:#8be9fd;font-style:italic">options</span>
</span></span><span style="display:flex;"><span>                       <span style="color:#50fa7b">usingBlock:</span>(<span style="color:#8be9fd">id</span>)<span style="color:#8be9fd;font-style:italic">block</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#50fa7b">error:</span>(NSError <span style="color:#ff79c6">**</span>)<span style="color:#8be9fd;font-style:italic">error</span>;
</span></span></code></pre></div><p>å®é™…ä¸ºåŒä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯åŒåä¸åŒç±»å‹çš„æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯é™æ€ç±»æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯æˆå‘˜æ–¹æ³•ã€‚
ä½¿ç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥ç»™ç±»çš„å®ä¾‹æ–¹æ³•æ·»åŠ ä¸€ä¸ªBlockï¼Œå¹¶ä¸”å¯¹è¿™ä¸ªç±»çš„æ‰€æœ‰å¯¹è±¡éƒ½ä¼šèµ·ä½œç”¨ã€‚</p>
<p>æ‰€æœ‰çš„è°ƒç”¨,éƒ½ä¼šæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚Aspects ä½¿ç”¨äº†Objective-C çš„æ¶ˆæ¯è½¬å‘æœºä¼š,ä¼šæœ‰ä¸€å®šçš„æ€§èƒ½æ¶ˆè€—ã€‚æ‰€æœ‰å¯¹äºè¿‡äºé¢‘ç¹çš„è°ƒç”¨,ä¸å»ºè®®ä½¿ç”¨ Aspectsã€‚Aspectsæ›´é€‚ç”¨äºè§†å›¾/æ§åˆ¶å™¨ç›¸å…³çš„ç­‰æ¯ç§’è°ƒç”¨ä¸è¶…è¿‡1000æ¬¡çš„ä»£ç ã€‚</p>
<h6 id="ä»£ç ç¤ºä¾‹">ä»£ç ç¤ºä¾‹</h6>
<p>åœ¨è°ƒè¯•åº”ç”¨æ—¶,ä½¿ç”¨AspectsåŠ¨æ€æ·»åŠ æ—¥å¿—è®°å½•åŠŸèƒ½ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-objective-c" data-lang="objective-c"><span style="display:flex;"><span>[UIViewController <span style="color:#8be9fd;font-style:italic">aspect_hookSelector</span>:<span style="color:#ff79c6">@selector</span>(<span style="color:#8be9fd;font-style:italic">viewWillAppear</span>:) <span style="color:#8be9fd;font-style:italic">withOptions</span>:AspectPositionAfter <span style="color:#8be9fd;font-style:italic">usingBlock</span>:<span style="color:#ff79c6">^</span>(<span style="color:#8be9fd">id</span><span style="color:#ff79c6">&lt;</span>AspectInfo<span style="color:#ff79c6">&gt;</span> aspectInfo) {
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//NSLog(@&#34;ğŸ˜œğŸ˜œğŸ˜œAppear:--&gt; %@&#34;, aspectInfo.instance);ï¼ˆä¸ºä»€ä¹ˆä¸ä½¿ç”¨æ­¤æ–¹å¼ï¼Œè¯·æŸ¥çœ‹è¯„è®ºï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    NSLog(<span style="color:#f1fa8c">@&#34;ğŸ˜œğŸ˜œğŸ˜œAppear:--&gt; %@&#34;</span>, NSStringFromClass([aspectInfo.instance <span style="color:#ff79c6">class</span>]));
</span></span><span style="display:flex;"><span>} <span style="color:#8be9fd;font-style:italic">error</span>:<span style="color:#8be9fd;font-style:italic">NULL</span>];
</span></span></code></pre></div><p>é€šè¿‡è¿™æ®µä»£ç ï¼Œæˆ‘ä»¬ç»™UIViewControllerçš„viewWillAppear:æ–¹æ³•æ·»åŠ äº†ä¸€ä¸ªé’©å­ï¼Œæ¯å½“åœ¨è°ƒç”¨viewWillAppear:åå°±ä¼šæ‰§è¡Œblockä¸­çš„ä»£ç ã€‚åœ¨æ­¤æˆ‘ä»¬æ‰“å°äº†ä¸€æ®µLogï¼ˆåŠ ä¸Šemojiè¡¨æƒ…å°±æ›´å¥½æ‰¾logå•¦ï¼‰ï¼Œé€šè¿‡logæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å½“å‰æ˜¾ç¤ºçš„é¡µé¢çš„VCåç§°ï¼Œä»è€Œå¿«é€Ÿå®šä½åˆ°è¯¥ç±»ã€‚è¿˜å¯ä»¥åœ¨ViewControllerçš„Deallocæ—¶æ‰“å°logï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-objective-c" data-lang="objective-c"><span style="display:flex;"><span>[UIViewController <span style="color:#8be9fd;font-style:italic">aspect_hookSelector</span>:NSSelectorFromString(<span style="color:#f1fa8c">@&#34;dealloc&#34;</span>) <span style="color:#8be9fd;font-style:italic">withOptions</span>:AspectPositionBefore <span style="color:#8be9fd;font-style:italic">usingBlock</span>:<span style="color:#ff79c6">^</span>(<span style="color:#8be9fd">id</span><span style="color:#ff79c6">&lt;</span>AspectInfo<span style="color:#ff79c6">&gt;</span> aspectInfo) {
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">//NSLog(@&#34;ğŸ˜‚ğŸ˜‚ğŸ˜‚Dealloc:----&gt;: %@&#34;, aspectInfo.instance);ï¼ˆä¸ºä»€ä¹ˆä¸ä½¿ç”¨æ­¤æ–¹å¼ï¼Œè¯·æŸ¥çœ‹è¯„è®ºï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        NSLog(<span style="color:#f1fa8c">@&#34;ğŸ˜‚ğŸ˜‚ğŸ˜‚Dealloc:----&gt;: %@&#34;</span>, NSStringFromClass([aspectInfo.instance <span style="color:#ff79c6">class</span>]));
</span></span><span style="display:flex;"><span>    } <span style="color:#8be9fd;font-style:italic">error</span>:<span style="color:#8be9fd;font-style:italic">NULL</span>];
</span></span></code></pre></div><p>ä¸ä¸Šä¸€æ®µä»£ç çš„å¾®å°å·®åˆ«æ˜¯Selectoræ¢æˆäº†NSSelectorFromString(@&ldquo;dealloc&rdquo;)ï¼Œè€Œä¸æ˜¯@selector(dealloc)ï¼Œè¿™æ˜¯å› ä¸ºåœ¨ARCä¸‹é¢æ˜¯ä¸èƒ½ç›´æ¥æ‰‹åŠ¨è°ƒç”¨Deallocçš„ï¼Œ@selector(dealloc)ä¼šè¢«ç¼–è¯‘å™¨ç›´æ¥æŠ¥é”™ã€‚</p>
<p>é€šè¿‡è¿™ä¸ªlogï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ViewControlleræ˜¯å¦é‡Šæ”¾ï¼Œå¦‚æœæ²¡æœ‰é‡Šæ”¾å¾ˆå¯èƒ½å°±æ˜¯æœ‰å¾ªç¯å¼•ç”¨ï¼Œè¿™æ—¶ä½ åŠ¡å¿…ä»”ç»†æ£€æŸ¥ä½ çš„ä»£ç ï¼Œè¿™åœ¨æ€§èƒ½è°ƒè¯•å’Œdebugä¸­éå¸¸æœ‰ç”¨ã€‚</p>
<h4 id="aopå®æˆ˜">AOPå®æˆ˜</h4>
<p>åœ¨å®é™…çš„é¡¹ç›®å¼€å‘ä¸­ï¼Œäº‹ä»¶ç»Ÿè®¡æ˜¯å¾ˆå¤šAPPéƒ½ä¼šæ·»åŠ ä¸€é¡¹é‡è¦åŠŸèƒ½ï¼Œå®ƒèƒ½ç»Ÿè®¡ç”¨æˆ·çš„è¡Œä¸ºã€å•†å“çš„é”€å”®çŠ¶å†µã€å•†å“æŸ¥çœ‹æ•°æ®ç­‰ï¼Œä»Šå¤©çš„AOPå®æˆ˜æ˜¯åˆ©ç”¨AOPå®ç°APPäº‹ä»¶ç»Ÿè®¡ã€‚</p>
<h5 id="è¿™æ ·ç»Ÿè®¡">è¿™æ ·ç»Ÿè®¡ï¼Ÿ</h5>
<p>å‡è®¾äº§å“æœ‰è¿™ä¹ˆä¸ªéœ€æ±‚ï¼šå½“ç”¨æˆ·åœ¨è¯¦æƒ…é¡µç‚¹å‡»æ·»åŠ åˆ°è´­ç‰©è½¦æŒ‰é’®æ—¶ï¼Œè®°å½•ä¸€ä¸‹äº‹ä»¶ã€‚æˆ‘ä»¬å®ç°èµ·æ¥å¤§æ¦‚ä¼šæ˜¯è¿™æ ·</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-objective-c" data-lang="objective-c"><span style="display:flex;"><span>- (<span style="color:#8be9fd">void</span>)<span style="color:#50fa7b">onBuyButtonClicked:</span>(<span style="color:#8be9fd">id</span>)<span style="color:#8be9fd;font-style:italic">sender</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    [XXXAnalytics <span style="color:#8be9fd;font-style:italic">track</span>:eventName <span style="color:#8be9fd;font-style:italic">properties</span>:properties];
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>è¿™ä¸ªéœ€æ±‚å°±è¿™æ ·è½»æ¾æå®šäº†ï¼Œä½†ç»†ç»†æƒ³æƒ³è¿˜æ˜¯æœ‰ä¸å°‘é—®é¢˜çš„ï¼š</p>
<ul>
<li>é¡µé¢ä¸Šä¼šæœ‰å…¶ä»–çš„ Buttonï¼Œå¯èƒ½æ¯ä¸ª Button éƒ½è¦æ”¾ä¸Šè¿™ä¹ˆä¸€æ®µä»£ç ã€‚</li>
<li>è¿™äº›ç»Ÿè®¡å…¶å®è·Ÿå…·ä½“çš„ä¸šåŠ¡æ— å…³ï¼Œæ²¡å¿…è¦è·Ÿä¸šåŠ¡ä»£ç æ··æ‚åœ¨ä¸€èµ·ï¼Œä¸ä¼˜é›…ã€‚</li>
<li>å½“æ”¹ç‰ˆæˆ–è€…é‡æ„æ—¶ï¼Œæœ‰å¯èƒ½å¿˜äº†æŠŠç›¸åº”çš„äº‹ä»¶ç»Ÿè®¡ä»£ç è¿ç§»è¿‡å»ã€‚</li>
</ul>
<h5 id="ä½¿ç”¨aopå®ç°ç»Ÿè®¡">ä½¿ç”¨AOPå®ç°ç»Ÿè®¡</h5>
<p>åŸºäºä¸Šé¢çš„é—®é¢˜ï¼Œéœ€è¦å°†äº‹ä»¶ç»Ÿè®¡è¿™æ®µä»£ç æŠ½ç¦»ï¼Œä¸å…·ä½“ç‚¹å‡»äº‹ä»¶é€»è¾‘ä»£ç è§£è€¦ã€‚é€šè¿‡AOPåœ¨è¿è¡Œæ—¶å°†äº‹ä»¶ç»Ÿè®¡çš„ä»£ç åŠ å…¥åˆ°æ–¹æ³•ä¸­æ­£æ˜¯è¿™ä¸ªé—®é¢˜çš„æœ€ä½³è§£ã€‚ä»£ç å¤§æ¦‚å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-objective-c" data-lang="objective-c"><span style="display:flex;"><span>[PBAGoodsDetailViewController <span style="color:#8be9fd;font-style:italic">aspect_hookSelector</span>:<span style="color:#ff79c6">@selector</span>(<span style="color:#8be9fd;font-style:italic">onBuyButtonClicked</span>:) <span style="color:#8be9fd;font-style:italic">withOptions</span>:AspectPositionAfter <span style="color:#8be9fd;font-style:italic">usingBlock</span>:<span style="color:#ff79c6">^</span>(<span style="color:#8be9fd">id</span><span style="color:#ff79c6">&lt;</span>AspectInfo<span style="color:#ff79c6">&gt;</span> aspectInfo) {
</span></span><span style="display:flex;"><span>        [XXXAnalytics <span style="color:#8be9fd;font-style:italic">track</span>:eventName <span style="color:#8be9fd;font-style:italic">properties</span>:properties];
</span></span><span style="display:flex;"><span>    } <span style="color:#8be9fd;font-style:italic">error</span>:<span style="color:#8be9fd;font-style:italic">NULL</span>];
</span></span></code></pre></div><h6 id="å¤šä¸ªäº‹ä»¶">å¤šä¸ªäº‹ä»¶ï¼Ÿ</h6>
<p>å½“ç„¶äº‹ä»¶ç»Ÿè®¡å¾€å¾€éœ€è¦ç»Ÿè®¡å¤šä¸ªäº‹ä»¶ï¼Œè¿™æ—¶æˆ‘ä»¬åªè¦å¯¹è¯¥æ–¹æ³•ç¨å¾®æŠ½è±¡ä¸€ä¸‹å°±å¯ä»¥äº†ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-objective-c" data-lang="objective-c"><span style="display:flex;"><span>- (<span style="color:#8be9fd">void</span>)<span style="color:#50fa7b">setupAnalytics</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    [<span style="color:#8be9fd;font-style:italic">self</span> <span style="color:#8be9fd;font-style:italic">trackEventWithClass</span>:aViewController <span style="color:#8be9fd;font-style:italic">selector</span>:@seletor(<span style="color:#8be9fd;font-style:italic">onBuyButtonTapped</span>:) <span style="color:#8be9fd;font-style:italic">event</span>:kSomeEventYouDefined];
</span></span><span style="display:flex;"><span>    [<span style="color:#8be9fd;font-style:italic">self</span> <span style="color:#8be9fd;font-style:italic">trackEventWithClass</span>:bViewController <span style="color:#8be9fd;font-style:italic">selector</span>:@seletor(<span style="color:#8be9fd;font-style:italic">followButtonTapped</span>:) <span style="color:#8be9fd;font-style:italic">event</span>:kAnotherEventYouDefined];
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>}
</span></span><span style="display:flex;"><span>- (<span style="color:#8be9fd">void</span>)<span style="color:#50fa7b">trackEventWithClass:</span>(<span style="color:#8be9fd">Class</span>)<span style="color:#8be9fd;font-style:italic">klass</span> <span style="color:#50fa7b">selector:</span>(<span style="color:#8be9fd">SEL</span>)<span style="color:#8be9fd;font-style:italic">selector</span> <span style="color:#50fa7b">event:</span>(NSString <span style="color:#ff79c6">*</span>)<span style="color:#8be9fd;font-style:italic">event</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>[klass <span style="color:#8be9fd;font-style:italic">aspect_hookSelector</span>:<span style="color:#ff79c6">@selector</span>(selector) <span style="color:#8be9fd;font-style:italic">withOptions</span>:AspectPositionAfter <span style="color:#8be9fd;font-style:italic">usingBlock</span>:<span style="color:#ff79c6">^</span>(<span style="color:#8be9fd">id</span><span style="color:#ff79c6">&lt;</span>AspectInfo<span style="color:#ff79c6">&gt;</span> aspectInfo) {
</span></span><span style="display:flex;"><span>    [XXXAnalytics <span style="color:#8be9fd;font-style:italic">track</span>:eventName <span style="color:#8be9fd;font-style:italic">properties</span>:properties];
</span></span><span style="display:flex;"><span>    } <span style="color:#8be9fd;font-style:italic">error</span>:<span style="color:#8be9fd;font-style:italic">NULL</span>];
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h6 id="ä½¿ç”¨plistæ–‡ä»¶é…ç½®äº‹ä»¶ç»Ÿè®¡">ä½¿ç”¨plistæ–‡ä»¶é…ç½®äº‹ä»¶ç»Ÿè®¡</h6>
<p>å½“äº‹ä»¶éå¸¸å¤šæ—¶ï¼Œä½ çš„setupAnalyticsæ–¹æ³•å°†ä¼šå˜å¾—è¶Šæ¥è¶Šé•¿ï¼Œè€Œä¸”ä¸å¥½ç»´æŠ¤ã€‚å¦‚æœæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸€å¼ è¡¨æ ¼æ¥é…ç½®äº‹ä»¶ç»Ÿè®¡ï¼Œçœ‹èµ·æ¥ä¼šæ›´åŠ ç›´è§‚ç®€æ´ã€‚
ä½¿ç”¨Xcodeåˆ›å»ºä¸€ä¸ªplistæ–‡ä»¶ï¼Œå…¶æ–‡ä»¶ç»“æ„å¦‚å›¾ï¼š

  <img src="https://s2.loli.net/2022/03/05/EkG5zNracTyJCSR.png" alt="EventList.plish">


ä½¿ç”¨ç±»åä½œä¸ºå­—å…¸çš„é”®ï¼Œå€¼ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„å†…å­˜æ”¾è¯¥ç±»ä¸‹çš„äº‹ä»¶åˆ—è¡¨ï¼Œæ¯ä¸ªäº‹ä»¶åŒ…å«äº‹ä»¶ID(EventId)å’Œè§¦å‘äº‹ä»¶çš„æ–¹æ³•åç§°ï¼ˆMethodNameï¼‰ã€‚
åœ¨AppDelegate.mä¸­ï¼Œæ·»åŠ äº‹ä»¶ç»Ÿè®¡çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-objective-c" data-lang="objective-c"><span style="display:flex;"><span>- (<span style="color:#8be9fd">void</span>)<span style="color:#50fa7b">setupAnalytics</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//è®¾ç½®äº‹ä»¶ç»Ÿè®¡
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#6272a4">//æ”¾åˆ°å¼‚æ­¥çº¿ç¨‹å»æ‰§è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">__weak</span> <span style="color:#ff79c6">typeof</span>(<span style="color:#8be9fd;font-style:italic">self</span>) ws <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">self</span>;
</span></span><span style="display:flex;"><span>    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span style="color:#bd93f9">0</span>), <span style="color:#ff79c6">^</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">//è¯»å–é…ç½®æ–‡ä»¶ï¼Œè·å–éœ€è¦ç»Ÿè®¡çš„äº‹ä»¶åˆ—è¡¨
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        NSString <span style="color:#ff79c6">*</span>path <span style="color:#ff79c6">=</span> [[NSBundle mainBundle] <span style="color:#8be9fd;font-style:italic">pathForResource</span>:<span style="color:#f1fa8c">@&#34;EventList&#34;</span> <span style="color:#8be9fd;font-style:italic">ofType</span>:<span style="color:#f1fa8c">@&#34;plist&#34;</span>];
</span></span><span style="display:flex;"><span>        NSDictionary <span style="color:#ff79c6">*</span>eventStatisticsDict <span style="color:#ff79c6">=</span> [[NSDictionary alloc] <span style="color:#8be9fd;font-style:italic">initWithContentsOfFile</span>:path];
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">for</span> (NSString <span style="color:#ff79c6">*</span>classNameString <span style="color:#ff79c6">in</span> eventStatisticsDict.allKeys) {
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">//ä½¿ç”¨è¿è¡Œæ—¶åˆ›å»ºç±»å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>            <span style="color:#ff79c6">const</span> <span style="color:#8be9fd">char</span> <span style="color:#ff79c6">*</span> className <span style="color:#ff79c6">=</span> [classNameString UTF8String];
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">//ä»ä¸€ä¸ªå­—ä¸²è¿”å›ä¸€ä¸ªç±»
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>            <span style="color:#8be9fd">Class</span> newClass <span style="color:#ff79c6">=</span> objc_getClass(className);
</span></span><span style="display:flex;"><span>            NSArray <span style="color:#ff79c6">*</span>pageEventList <span style="color:#ff79c6">=</span> [eventStatisticsDict <span style="color:#8be9fd;font-style:italic">objectForKey</span>:classNameString];
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">for</span> (NSDictionary <span style="color:#ff79c6">*</span>eventDict <span style="color:#ff79c6">in</span> pageEventList) {
</span></span><span style="display:flex;"><span>                <span style="color:#6272a4">//äº‹ä»¶æ–¹æ³•åç§°
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>                NSString <span style="color:#ff79c6">*</span>eventMethodName <span style="color:#ff79c6">=</span> eventDict[<span style="color:#f1fa8c">@&#34;MethodName&#34;</span>];
</span></span><span style="display:flex;"><span>                <span style="color:#8be9fd">SEL</span> seletor <span style="color:#ff79c6">=</span> NSSelectorFromString(eventMethodName);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                NSString <span style="color:#ff79c6">*</span>eventId <span style="color:#ff79c6">=</span> eventDict[<span style="color:#f1fa8c">@&#34;EventId&#34;</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                [<span style="color:#8be9fd;font-style:italic">self</span> <span style="color:#8be9fd;font-style:italic">trackEventWithClass</span>:newClass <span style="color:#8be9fd;font-style:italic">selector</span>:seletor <span style="color:#8be9fd;font-style:italic">event</span>:eventId];
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>è‡³æ­¤ï¼Œä¸€åˆ‡å¥½åƒéƒ½å¥½åƒå®Œç¾äº†ï¼Œä½†äººç”Ÿæ€»æ˜¯å……æ»¡äº†å˜æ•°ã€‚</p>
<h6 id="äº‹ä»¶éœ€è¦ä¼ é€’å‚æ•°">äº‹ä»¶éœ€è¦ä¼ é€’å‚æ•°</h6>
<p>ä¸€ä¸ªé˜³å…‰æ˜åªšçš„ä¸Šåˆï¼Œäº§å“è·‘è¿‡æ¥å’Œæˆ‘è¯´äº‹ä»¶ç»Ÿè®¡éœ€è¦ä¼ é€’ä¸€äº›å‚æ•°ï¼Œæ¯”å¦‚ç‚¹å‡»æŸ¥çœ‹å•†å“è¯¦æƒ…äº‹ä»¶éœ€è¦ä¼ é€’å•†å“IDå’Œå•†å“åç§°ã€‚æˆ‘å½“æ—¶å¿ƒä¸­å°±ä¸€ä¸‡åªè‰æ³¥é©¬åœ¨å¥”è…¾ï¼Œä½†æ˜¯æ²¡åŠæ³•å‘€ï¼æˆ‘ä»¬åªæ˜¯æ¬ç –çš„ç¨‹åºçŒ¿ï¼Œåªèƒ½ä½å¤´é»˜é»˜çš„æ”¹ã€‚å¥½ä¸å®¹æ˜“è®¾è®¡å¥½çš„æ¶æ„ï¼Œçœ¼çœ‹å°±è¦æ‰“å›åŸå½¢ã€‚åæ¥ä»”ç»†ç ”ç©¶ä¸€ç•ªå‘ç°ï¼Œå…¶å®Aspectsæ˜¯å¯ä»¥é€šè¿‡Blockè·å–åˆ°æ–¹æ³•ä¼ é€’çš„å‚æ•°çš„ï¼Œé©¬ä¸Šå¿ƒæƒ…å¥½äº†è®¸å¤šï¼Œä¿®æ”¹æ€è·¯é©¬ä¸Šå†è„‘æµ·å½¢æˆã€‚</p>
<p>é¦–å…ˆï¼Œå°†Blockæ”¹ä¸º<code>^(id&lt;AspectInfo&gt; aspectInfo, NSDictionary *dict)</code>ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸€å®šè¦ä¸º<code>id&lt;AspectInfo&gt; aspectInfo</code>,åé¢æ¥æ–¹æ³•ä¼ é€’çš„å¯¹åº”ç±»å‹çš„å‚æ•°ï¼Œè¿™æ ·ä¾¿å¯ä»¥æ¥æ”¶åˆ°æ–¹æ³•è°ƒç”¨ä¼ é€’çš„å‚æ•°ã€‚ä½†æ˜¯æ¯ä¸€ä¸ªäº‹ä»¶éœ€è¦ä¼ é€’çš„å‚æ•°éƒ½å„ä¸ç›¸åŒï¼Œé‚£æˆ‘ä»¬è¦å¦‚ä½•é…ç½®å‘¢ï¼Ÿ
æˆ‘çš„æ–¹æ¡ˆæ˜¯ï¼šåœ¨plistçš„äº‹ä»¶å­—å…¸ä¸­åŠ å…¥ä¸€ä¸ªé”®ä¸ºParamsï¼Œå€¼ä¸ºæ•°ç»„çš„é”®å€¼å¯¹ã€‚ä¿®æ”¹åé…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<p>
  <img src="https://s2.loli.net/2022/03/05/S6umyXa4MRZn1Af.png" alt="EventListV2">


ç»Ÿè®¡ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-objective-c" data-lang="objective-c"><span style="display:flex;"><span>- (<span style="color:#8be9fd">void</span>)<span style="color:#50fa7b">setupAnalytics</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//è®¾ç½®äº‹ä»¶ç»Ÿè®¡
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#6272a4">//æ”¾åˆ°å¼‚æ­¥çº¿ç¨‹å»æ‰§è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">__weak</span> <span style="color:#ff79c6">typeof</span>(<span style="color:#8be9fd;font-style:italic">self</span>) ws <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">self</span>;
</span></span><span style="display:flex;"><span>    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span style="color:#bd93f9">0</span>), <span style="color:#ff79c6">^</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">//è¯»å–é…ç½®æ–‡ä»¶ï¼Œè·å–éœ€è¦ç»Ÿè®¡çš„äº‹ä»¶åˆ—è¡¨
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        NSString <span style="color:#ff79c6">*</span>path <span style="color:#ff79c6">=</span> [[NSBundle mainBundle] <span style="color:#8be9fd;font-style:italic">pathForResource</span>:<span style="color:#f1fa8c">@&#34;EventList&#34;</span> <span style="color:#8be9fd;font-style:italic">ofType</span>:<span style="color:#f1fa8c">@&#34;plist&#34;</span>];
</span></span><span style="display:flex;"><span>        NSDictionary <span style="color:#ff79c6">*</span>eventStatisticsDict <span style="color:#ff79c6">=</span> [[NSDictionary alloc] <span style="color:#8be9fd;font-style:italic">initWithContentsOfFile</span>:path];
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">for</span> (NSString <span style="color:#ff79c6">*</span>classNameString <span style="color:#ff79c6">in</span> eventStatisticsDict.allKeys) {
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">//ä½¿ç”¨è¿è¡Œæ—¶åˆ›å»ºç±»å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>            <span style="color:#ff79c6">const</span> <span style="color:#8be9fd">char</span> <span style="color:#ff79c6">*</span> className <span style="color:#ff79c6">=</span> [classNameString UTF8String];
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">//ä»ä¸€ä¸ªå­—ä¸²è¿”å›ä¸€ä¸ªç±»
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>            <span style="color:#8be9fd">Class</span> newClass <span style="color:#ff79c6">=</span> objc_getClass(className);
</span></span><span style="display:flex;"><span>            NSArray <span style="color:#ff79c6">*</span>pageEventList <span style="color:#ff79c6">=</span> [eventStatisticsDict <span style="color:#8be9fd;font-style:italic">objectForKey</span>:classNameString];
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">for</span> (NSDictionary <span style="color:#ff79c6">*</span>eventDict <span style="color:#ff79c6">in</span> pageEventList) {
</span></span><span style="display:flex;"><span>                <span style="color:#6272a4">//äº‹ä»¶æ–¹æ³•åç§°
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>                NSString <span style="color:#ff79c6">*</span>eventMethodName <span style="color:#ff79c6">=</span> eventDict[<span style="color:#f1fa8c">@&#34;MethodName&#34;</span>];
</span></span><span style="display:flex;"><span>                <span style="color:#8be9fd">SEL</span> seletor <span style="color:#ff79c6">=</span> NSSelectorFromString(eventMethodName);
</span></span><span style="display:flex;"><span>                NSString <span style="color:#ff79c6">*</span>eventId <span style="color:#ff79c6">=</span> eventDict[<span style="color:#f1fa8c">@&#34;EventId&#34;</span>];
</span></span><span style="display:flex;"><span>                NSArray <span style="color:#ff79c6">*</span>params <span style="color:#ff79c6">=</span> eventDict[<span style="color:#f1fa8c">@&#34;Params&#34;</span>];
</span></span><span style="display:flex;"><span>                [<span style="color:#8be9fd;font-style:italic">self</span> <span style="color:#8be9fd;font-style:italic">trackEventWithClass</span>:newClass <span style="color:#8be9fd;font-style:italic">selector</span>:seletor <span style="color:#8be9fd;font-style:italic">event</span>:eventId <span style="color:#8be9fd;font-style:italic">params</span>:params];
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ç»Ÿè®¡æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-objective-c" data-lang="objective-c"><span style="display:flex;"><span>- (<span style="color:#8be9fd">void</span>)<span style="color:#50fa7b">trackEventWithClass:</span>(<span style="color:#8be9fd">Class</span>)<span style="color:#8be9fd;font-style:italic">klass</span> <span style="color:#50fa7b">selector:</span>(<span style="color:#8be9fd">SEL</span>)<span style="color:#8be9fd;font-style:italic">selector</span> <span style="color:#50fa7b">event:</span>(NSString <span style="color:#ff79c6">*</span>)<span style="color:#8be9fd;font-style:italic">event</span> <span style="color:#50fa7b">params:</span>(NSArray <span style="color:#ff79c6">*</span>)<span style="color:#8be9fd;font-style:italic">paramNames</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    [klass <span style="color:#8be9fd;font-style:italic">aspect_hookSelector</span>:<span style="color:#ff79c6">@selector</span>(selector) <span style="color:#8be9fd;font-style:italic">withOptions</span>:AspectPositionAfter <span style="color:#8be9fd;font-style:italic">usingBlock</span>:<span style="color:#ff79c6">^</span>(<span style="color:#8be9fd">id</span><span style="color:#ff79c6">&lt;</span>AspectInfo<span style="color:#ff79c6">&gt;</span> aspectInfo, NSDictionary <span style="color:#ff79c6">*</span>dict) {
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">//å®šä¹‰ä¸äº‹ä»¶ç›¸å…³çš„å±æ€§ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        NSMutableDictionary <span style="color:#ff79c6">*</span>properties <span style="color:#ff79c6">=</span> [NSMutableDictionary dictionary];
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">//å¦‚æœæœ‰å‚æ•°ï¼Œé‚£ä¹ˆæŠŠå‚æ•°åå’Œå‚æ•°å€¼æ‹¼æ¥åœ¨eventIDä¹‹å
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        <span style="color:#ff79c6">if</span> (paramNames.count <span style="color:#ff79c6">&gt;</span> <span style="color:#bd93f9">0</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">if</span> ([dict <span style="color:#8be9fd;font-style:italic">isKindOfClass</span>:[NSDictionary <span style="color:#ff79c6">class</span>]]) {
</span></span><span style="display:flex;"><span>                <span style="color:#6272a4">//è·å–dict
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>                <span style="color:#ff79c6">for</span> (NSString <span style="color:#ff79c6">*</span>paramName <span style="color:#ff79c6">in</span> paramNames) {
</span></span><span style="display:flex;"><span>                    <span style="color:#6272a4">//æ·»åŠ æ‰€éœ€å‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>                    NSString <span style="color:#ff79c6">*</span>paramValue <span style="color:#ff79c6">=</span> [dict <span style="color:#8be9fd;font-style:italic">objectForKey</span>:paramName];
</span></span><span style="display:flex;"><span>                    properties[paramName] <span style="color:#ff79c6">=</span> paramValue;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        [XXXAnalytics <span style="color:#8be9fd;font-style:italic">track</span>:eventName <span style="color:#8be9fd;font-style:italic">properties</span>:properties];
</span></span><span style="display:flex;"><span>    } <span style="color:#8be9fd;font-style:italic">error</span>:<span style="color:#8be9fd;font-style:italic">NULL</span>];
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>å°†éœ€è¦ä¼ é€’çš„å‚æ•°ä»¥å­—å…¸æ ¼å¼ä½œä¸ºæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒParamsä¸­é…ç½®äº‹ä»¶ç»Ÿè®¡éœ€è¦ä¼ é€’çš„å‚æ•°çš„Keyï¼Œé€šè¿‡æ­¤æ–¹æ³•å¯ä»¥ä¼ é€’ä»»ä½•æˆ‘ä»¬éœ€è¦ä¼ é€’çš„å‚æ•°ï¼Œä½¿ç”¨plistå¿«é€Ÿã€çµæ´»é…ç½®éœ€è¦ä¼ é€’çš„å‚æ•°ã€‚å®æˆ˜å†…å®¹åˆ°æ­¤åŸºæœ¬ç»“æŸï¼Œæˆ‘ä»¬ä½¿ç”¨AOPå·²ç»å®ç°äº†ä¸€ä¸ªä½è€¦åˆã€å¯çµæ´»é…ç½®çš„äº‹ä»¶ç»Ÿè®¡ã€‚</p>
<h4 id="è¿˜æœ‰ä¸€äº›æŒ‘æˆ˜">è¿˜æœ‰ä¸€äº›æŒ‘æˆ˜</h4>
<p>åœ¨ä½¿ç”¨Aspectsä¸­æˆ‘å‘ç°ï¼Œå¦‚æœæ–¹æ³•ä¸ºç±»æ–¹æ³•æ—¶ï¼Œå¹¶ä¸ä¼šå›è°ƒblockã€‚åœ¨è°ƒç”¨aspect_hookSelector:withOptions:usingBlock:æ—¶ï¼ŒæŠ¥<code>Aspects: Block signature &lt;NSMethodSignature: 0x7fa13345ce60&gt; doesn't match (null).</code>é”™è¯¯æç¤ºï¼Œæ„æ€æ˜¯blockä¸åŒ¹é…ï¼Œå…¶æ ¹æœ¬åŸå› åœ¨äºæ— æ³•ä½¿ç”¨Classè·å–è¯¥Classçš„ç±»æ–¹æ³•ï¼Œé€šè¿‡runtimeåªèƒ½è·å–åˆ°æˆå‘˜æ–¹æ³•ï¼Œè€Œç±»æ–¹æ³•éœ€è¦ä½¿ç”¨è¯¥Classçš„MetaClassè·å–ï¼ŒMateClasså¯ä»¥ä½¿ç”¨<code>object_getClass(newClass)</code>å¾—åˆ°ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-objective-c" data-lang="objective-c"><span style="display:flex;"><span>[ws <span style="color:#8be9fd;font-style:italic">trackEventWithClass</span>:object_getClass(newClass) <span style="color:#8be9fd;font-style:italic">selector</span>:seletor <span style="color:#8be9fd;font-style:italic">event</span>:eventId <span style="color:#8be9fd;font-style:italic">params</span>:params];
</span></span></code></pre></div><p>ä¿®æ”¹åè™½ç„¶ä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯ä¾ç„¶ä¸ä¼šè§¦å‘blockã€‚æŸ¥çœ‹Aspectsçš„githubä»‹ç»å‘ç°ï¼ŒAspectså‹æ ¹å°±ä¸æ”¯æŒç±»æ–¹æ³•ï¼Œè¿™è®©æˆ‘å¾ˆæ˜¯è‹¦æ¼ã€‚ä¸è¿‡æŒ‰é“ç†åº”è¯¥æ˜¯å¯ä»¥çš„ï¼Œäºæ˜¯å’ŒåŒäº‹è®¨è®ºäº†ä¸€ä¸‹ï¼Œå°±ä½¿ç”¨Method Swizzlingåšäº†äº¤æ¢ä¸¤ä¸ªç±»æ–¹æ³•çš„è¯•éªŒï¼Œç»“æœæ˜¯æˆåŠŸäº†ã€‚</p>
<p>æŸ¥çœ‹Aspectsçš„æºä»£ç å‘ç°ï¼ŒAspectsäº¤æ¢çš„æ˜¯æˆå‘˜æ–¹æ³•ã€‚æ— å¥ˆæœ€ååªèƒ½ä¿®æ”¹Aspectsçš„æºä»£ç ï¼Œæˆ‘åœ¨å…¶ä¸­ä¸€æ–¹æ³•ä¸­åŠ å…¥äº†Classç±»å‹åˆ¤æ–­ï¼Œå¦‚æœæ˜¯MetaClassï¼Œé‚£ä¹ˆå°±åˆå§‹åŒ–ä¸ºç±»æ–¹æ³•ï¼Œè€Œéæˆå‘˜æ–¹æ³•ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-objective-c" data-lang="objective-c"><span style="display:flex;"><span><span style="color:#ff79c6">static</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">aspect_prepareClassAndHookSelector</span>(NSObject <span style="color:#ff79c6">*</span><span style="color:#8be9fd;font-style:italic">self</span>, <span style="color:#8be9fd">SEL</span> selector, NSError <span style="color:#ff79c6">**</span>error) {
</span></span><span style="display:flex;"><span>    NSCParameterAssert(selector);
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">Class</span> klass <span style="color:#ff79c6">=</span> aspect_hookClass(<span style="color:#8be9fd;font-style:italic">self</span>, error);
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//TODO:Edit bu JackYong
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    Method targetMethod;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">IMP</span> targetMethodIMP;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> (class_isMetaClass(klass)) {
</span></span><span style="display:flex;"><span>        targetMethod <span style="color:#ff79c6">=</span> class_getClassMethod(klass, selector);
</span></span><span style="display:flex;"><span>        targetMethodIMP <span style="color:#ff79c6">=</span> method_getImplementation(targetMethod);
</span></span><span style="display:flex;"><span>    } <span style="color:#ff79c6">else</span> {
</span></span><span style="display:flex;"><span>        targetMethod <span style="color:#ff79c6">=</span> class_getInstanceMethod(klass, selector);
</span></span><span style="display:flex;"><span>        targetMethodIMP <span style="color:#ff79c6">=</span> method_getImplementation(targetMethod);
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>ä¿®æ”¹åblockå’Œå¾€å¸¸ä¸€æ ·è¢«è°ƒç”¨äº†ã€‚æš‚æ—¶ä½¿ç”¨æ²¡æœ‰é‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Œä¸è¿‡ç›®æµ‹åº”è¯¥æ˜¯æœ‰bugçš„ï¼Œä¸ç„¶Aspectsçš„å¼€å‘è€…æ—©å°±åŠ äº†è¿™åˆ¤æ–­ã€‚
Demoï¼šhttps://github.com/yongca887/AOPDemo</p>
<h5 id="aspectsçš„å‘">Aspectsçš„å‘</h5>
<ul>
<li>1.æ— æ³•ä¸ºç±»æ–¹æ³•æ·»åŠ hookingï¼ˆé€šè¿‡ä¸Šé¢çš„æ–¹æ³•æš‚æ—¶å¯ä»¥è§£å†³ï¼Œä¸è¿‡è¿˜æ˜¯ä¸å¤ªå»ºè®®ä½¿ç”¨ï¼‰</li>
<li>2.Blockæ— æ³•è‡ªåŠ¨åˆ¤æ–­å‚æ•°ä¸ªæ•°ï¼Œè‡ªåŠ¨åŒ¹é…ã€‚å¦‚æœä½ æ·»åŠ ä¸€ä¸ªæ— å‚çš„æ–¹æ³•ï¼Œè€ŒBlockä¸­æœ‰è·Ÿä¸€ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆä½ ä¼šæ”¶åˆ°Blockä¸åŒ¹é…çš„é”™è¯¯ã€‚</li>
</ul>
<blockquote>
<p>å‚è€ƒ
<a href="http://my.oschina.net/leejun2005/blog/504732">iOS ç»Ÿè®¡æ‰“ç‚¹é‚£äº›äº‹</a></p>
</blockquote>


                

                
                <hr>
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/post/wordpress%E4%B8%BB%E9%A2%98%E5%88%B6%E4%BD%9C%E5%BF%83%E5%BE%97/" data-toggle="tooltip" data-placement="top" title="WordPressä¸»é¢˜åˆ¶ä½œå¿ƒå¾—">&larr;
                            Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/post/%E8%A7%A3%E5%86%B3macos10.12%E7%A0%B4%E8%A7%A3%E8%BD%AF%E4%BB%B6%E5%B4%A9%E6%BA%83/" data-toggle="tooltip" data-placement="top" title="è§£å†³MacOS 10.12ç ´è§£è½¯ä»¶å´©æºƒ">Next
                            Post &rarr;</a>
                    </li>
                    
                </ul>
                

                
<script src="https://giscus.app/client.js"
        data-repo="xtcel/xtcel.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkxMTcyNTM1MjE"
        data-category="Announcements"
        data-category-id="DIC_kwDOBv0lkc4CN8jv"
        data-mapping="pathname"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-theme="light"
        data-lang="zh-CN"
        crossorigin="anonymous"
        async>
</script>



            </div>

            
            
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
            

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/cangjie" title="cangjie">
                            cangjie
                        </a>
                        
                        
                        
                        <a href="/tags/centos" title="centos">
                            centos
                        </a>
                        
                        
                        
                        <a href="/tags/electron" title="electron">
                            electron
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/flutter" title="flutter">
                            flutter
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/ios" title="ios">
                            ios
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/mac" title="mac">
                            mac
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E4%BB%93%E9%A2%89" title="ä»“é¢‰">
                            ä»“é¢‰
                        </a>
                        
                        
                        
                        <a href="/tags/%E4%BB%93%E9%A2%89%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80" title="ä»“é¢‰ç¼–ç¨‹è¯­è¨€">
                            ä»“é¢‰ç¼–ç¨‹è¯­è¨€
                        </a>
                        
                        
                        
                        <a href="/tags/%E4%BB%93%E9%A2%89%E8%AF%AD%E8%A8%80" title="ä»“é¢‰è¯­è¨€">
                            ä»“é¢‰è¯­è¨€
                        </a>
                        
                        
                        
                        <a href="/tags/%E4%BB%93%E9%A2%89%E8%AF%AD%E8%A8%80%E5%85%A5%E9%97%A8" title="ä»“é¢‰è¯­è¨€å…¥é—¨">
                            ä»“é¢‰è¯­è¨€å…¥é—¨
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E5%B4%A9%E6%BA%83" title="å´©æºƒ">
                            å´©æºƒ
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E9%98%B2%E7%81%AB%E5%A2%99%E9%85%8D%E7%BD%AE" title="é˜²ç«å¢™é…ç½®">
                            é˜²ç«å¢™é…ç½®
                        </a>
                        
                        
                    </div>
                </section>
                

                
                
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">                  
                    
                    <li>
                        <a href="mailto:xtcelzhangyong@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		           
                    
                    <li>
                        <a href="https://x.com/xtcel">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    

		            
                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/xtcel">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		            
                    
                    
                    
                    
                    
                    
                    
                    
                    
            
            
            
           
             </ul>
		<p class="copyright text-muted">
                    Copyright &copy; XTCEL Blog 2024 | ç²¤ICPå¤‡19158799å·-1
                    
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function loadAsync(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        loadAsync("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>






<script type="text/javascript">
    function generateCatalog(selector) {

        
        
        
        
            _containerSelector = 'div.post-container'
        

        
        var P = $(_containerSelector), a, n, t, l, i, c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        
        $(selector).html('')

        
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#" + $(this).prop('id');
            t = $(this).text();
            c = $('<a href="' + i + '" rel="nofollow">' + t + '</a>');
            l = $('<li class="' + n + '_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    
    $(".catalog-toggle").click((function (e) {
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    


    loadAsync("\/js\/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>






</body>
</html>
